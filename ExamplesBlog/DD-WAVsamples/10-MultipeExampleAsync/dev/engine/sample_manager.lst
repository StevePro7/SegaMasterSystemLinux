                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 4.1.0 #12072 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module sample_manager
                                      6 	.optsdcc -mz80
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _engine_sample_manager_init
                                     12 	.globl _engine_sample_manager_play
                                     13 	.globl _engine_sample_manager_stop
                                     14 	.globl _engine_sample_manager_isPlaying
                                     15 	.globl _engine_sample_manager_update
                                     16 ;--------------------------------------------------------
                                     17 ; special function registers
                                     18 ;--------------------------------------------------------
                                     19 ;--------------------------------------------------------
                                     20 ; ram data
                                     21 ;--------------------------------------------------------
                                     22 	.area _DATA
                                     23 ;--------------------------------------------------------
                                     24 ; ram data
                                     25 ;--------------------------------------------------------
                                     26 	.area _INITIALIZED
                           000000    27 Fsample_manager$sm_pcm_ptr$0_0$0==.
      000000                         28 _sm_pcm_ptr:
      000000                         29 	.ds 2
                           000002    30 Fsample_manager$sm_pcm_len$0_0$0==.
      000002                         31 _sm_pcm_len:
      000002                         32 	.ds 2
                           000004    33 Fsample_manager$sm_pcm_playing$0_0$0==.
      000004                         34 _sm_pcm_playing:
      000004                         35 	.ds 1
                                     36 ;--------------------------------------------------------
                                     37 ; absolute external ram data
                                     38 ;--------------------------------------------------------
                                     39 	.area _DABS (ABS)
                                     40 ;--------------------------------------------------------
                                     41 ; global & static initialisations
                                     42 ;--------------------------------------------------------
                                     43 	.area _HOME
                                     44 	.area _GSINIT
                                     45 	.area _GSFINAL
                                     46 	.area _GSINIT
                                     47 ;--------------------------------------------------------
                                     48 ; Home
                                     49 ;--------------------------------------------------------
                                     50 	.area _HOME
                                     51 	.area _HOME
                                     52 ;--------------------------------------------------------
                                     53 ; code
                                     54 ;--------------------------------------------------------
                                     55 	.area _CODE
                           000000    56 	G$engine_sample_manager_init$0$0	= .
                                     57 	.globl	G$engine_sample_manager_init$0$0
                           000000    58 	C$sample_manager.c$29$0_0$7	= .
                                     59 	.globl	C$sample_manager.c$29$0_0$7
                                     60 ;sample_manager.c:29: void engine_sample_manager_init( const void *psginit ) __naked __z88dk_fastcall
                                     61 ;	---------------------------------
                                     62 ; Function engine_sample_manager_init
                                     63 ; ---------------------------------
      000000                         64 _engine_sample_manager_init::
                           000000    65 	C$sample_manager.c$36$1_0$7	= .
                                     66 	.globl	C$sample_manager.c$36$1_0$7
                                     67 ;sample_manager.c:36: __endasm;
      000000 01 7F 0B         [10]   68 	ld	bc, #0x0b7f
      000003 ED B3            [21]   69 	otir
      000005 C9               [10]   70 	ret
                           000006    71 	C$sample_manager.c$37$1_0$7	= .
                                     72 	.globl	C$sample_manager.c$37$1_0$7
                                     73 ;sample_manager.c:37: }
                           000006    74 	G$engine_sample_manager_play$0$0	= .
                                     75 	.globl	G$engine_sample_manager_play$0$0
                           000006    76 	C$sample_manager.c$39$1_0$9	= .
                                     77 	.globl	C$sample_manager.c$39$1_0$9
                                     78 ;sample_manager.c:39: void engine_sample_manager_play( const void *sample ) __z88dk_fastcall
                                     79 ;	---------------------------------
                                     80 ; Function engine_sample_manager_play
                                     81 ; ---------------------------------
      000006                         82 _engine_sample_manager_play::
                           000006    83 	C$sample_manager.c$41$1_0$9	= .
                                     84 	.globl	C$sample_manager.c$41$1_0$9
                                     85 ;sample_manager.c:41: sm_pcm_ptr = ( const unsigned char* ) sample;
                           000006    86 	C$sample_manager.c$43$1_0$9	= .
                                     87 	.globl	C$sample_manager.c$43$1_0$9
                                     88 ;sample_manager.c:43: sm_pcm_len = sm_pcm_ptr[ 0 ];
      000006 22r00r00         [16]   89 	ld	(_sm_pcm_ptr), hl
      000009 7E               [ 7]   90 	ld	a, (hl)
      00000A 32r02r00         [13]   91 	ld	(_sm_pcm_len+0), a
      00000D AF               [ 4]   92 	xor	a, a
      00000E 32r03r00         [13]   93 	ld	(_sm_pcm_len+1), a
                           000011    94 	C$sample_manager.c$44$1_0$9	= .
                                     95 	.globl	C$sample_manager.c$44$1_0$9
                                     96 ;sample_manager.c:44: sm_pcm_len |= ( unsigned int ) sm_pcm_ptr[ 1 ] << 8;
      000011 2Ar00r00         [16]   97 	ld	hl, (_sm_pcm_ptr)
      000014 23               [ 6]   98 	inc	hl
      000015 4E               [ 7]   99 	ld	c, (hl)
      000016 3E 00            [ 7]  100 	ld	a, #0x00
      000018 FD 21r02r00      [14]  101 	ld	iy, #_sm_pcm_len
      00001C FD B6 00         [19]  102 	or	a, 0 (iy)
      00001F 32r02r00         [13]  103 	ld	(_sm_pcm_len+0), a
      000022 79               [ 4]  104 	ld	a, c
      000023 FD B6 01         [19]  105 	or	a, 1 (iy)
      000026 32r03r00         [13]  106 	ld	(_sm_pcm_len+1), a
                           000029   107 	C$sample_manager.c$46$1_0$9	= .
                                    108 	.globl	C$sample_manager.c$46$1_0$9
                                    109 ;sample_manager.c:46: sm_pcm_ptr += 2;
      000029 2Ar00r00         [16]  110 	ld	hl, (_sm_pcm_ptr)
      00002C 23               [ 6]  111 	inc	hl
      00002D 23               [ 6]  112 	inc	hl
      00002E 22r00r00         [16]  113 	ld	(_sm_pcm_ptr), hl
                           000031   114 	C$sample_manager.c$47$1_0$9	= .
                                    115 	.globl	C$sample_manager.c$47$1_0$9
                                    116 ;sample_manager.c:47: sm_pcm_playing = 1;
      000031 3E 01            [ 7]  117 	ld	a, #0x01
      000033 32r04r00         [13]  118 	ld	(#_sm_pcm_playing), a
                           000036   119 	C$sample_manager.c$48$1_0$9	= .
                                    120 	.globl	C$sample_manager.c$48$1_0$9
                                    121 ;sample_manager.c:48: }
                           000036   122 	C$sample_manager.c$48$1_0$9	= .
                                    123 	.globl	C$sample_manager.c$48$1_0$9
                           000036   124 	XG$engine_sample_manager_play$0$0	= .
                                    125 	.globl	XG$engine_sample_manager_play$0$0
      000036 C9               [10]  126 	ret
                           000037   127 	G$engine_sample_manager_stop$0$0	= .
                                    128 	.globl	G$engine_sample_manager_stop$0$0
                           000037   129 	C$sample_manager.c$50$1_0$11	= .
                                    130 	.globl	C$sample_manager.c$50$1_0$11
                                    131 ;sample_manager.c:50: void engine_sample_manager_stop( void )
                                    132 ;	---------------------------------
                                    133 ; Function engine_sample_manager_stop
                                    134 ; ---------------------------------
      000037                        135 _engine_sample_manager_stop::
                           000037   136 	C$sample_manager.c$52$1_0$11	= .
                                    137 	.globl	C$sample_manager.c$52$1_0$11
                                    138 ;sample_manager.c:52: sm_pcm_playing = 0;
      000037 3E 00            [ 7]  139 	ld	a, #0x00
      000039 32r04r00         [13]  140 	ld	(#_sm_pcm_playing), a
                           00003C   141 	C$sample_manager.c$53$1_0$11	= .
                                    142 	.globl	C$sample_manager.c$53$1_0$11
                                    143 ;sample_manager.c:53: }
                           00003C   144 	C$sample_manager.c$53$1_0$11	= .
                                    145 	.globl	C$sample_manager.c$53$1_0$11
                           00003C   146 	XG$engine_sample_manager_stop$0$0	= .
                                    147 	.globl	XG$engine_sample_manager_stop$0$0
      00003C C9               [10]  148 	ret
                           00003D   149 	G$engine_sample_manager_isPlaying$0$0	= .
                                    150 	.globl	G$engine_sample_manager_isPlaying$0$0
                           00003D   151 	C$sample_manager.c$55$1_0$13	= .
                                    152 	.globl	C$sample_manager.c$55$1_0$13
                                    153 ;sample_manager.c:55: unsigned char engine_sample_manager_isPlaying( void )
                                    154 ;	---------------------------------
                                    155 ; Function engine_sample_manager_isPlaying
                                    156 ; ---------------------------------
      00003D                        157 _engine_sample_manager_isPlaying::
                           00003D   158 	C$sample_manager.c$57$1_0$13	= .
                                    159 	.globl	C$sample_manager.c$57$1_0$13
                                    160 ;sample_manager.c:57: return sm_pcm_playing;
      00003D 3Ar04r00         [13]  161 	ld	a, (#_sm_pcm_playing + 0)
      000040 6F               [ 4]  162 	ld	l, a
                           000041   163 	C$sample_manager.c$58$1_0$13	= .
                                    164 	.globl	C$sample_manager.c$58$1_0$13
                                    165 ;sample_manager.c:58: }
                           000041   166 	C$sample_manager.c$58$1_0$13	= .
                                    167 	.globl	C$sample_manager.c$58$1_0$13
                           000041   168 	XG$engine_sample_manager_isPlaying$0$0	= .
                                    169 	.globl	XG$engine_sample_manager_isPlaying$0$0
      000041 C9               [10]  170 	ret
                           000042   171 	G$engine_sample_manager_update$0$0	= .
                                    172 	.globl	G$engine_sample_manager_update$0$0
                           000042   173 	C$sample_manager.c$60$1_0$15	= .
                                    174 	.globl	C$sample_manager.c$60$1_0$15
                                    175 ;sample_manager.c:60: void engine_sample_manager_update( void ) __naked
                                    176 ;	---------------------------------
                                    177 ; Function engine_sample_manager_update
                                    178 ; ---------------------------------
      000042                        179 _engine_sample_manager_update::
                           000042   180 	C$sample_manager.c$179$1_0$15	= .
                                    181 	.globl	C$sample_manager.c$179$1_0$15
                                    182 ;sample_manager.c:179: __endasm;
                                    183 ;	-------------------------------------- -
                                    184 ;	Check playing flag
                                    185 ;	-------------------------------------- -
      000042 3Ar04r00         [13]  186 	ld	a, ( #_sm_pcm_playing )
      000045 B7               [ 4]  187 	or	a
      000046 C8               [11]  188 	ret	z
                                    189 ;	-------------------------------------- -
                                    190 ;	Load sm_pcm_ptr → HL
                                    191 ;	HL = &_sm_pcm_ptr
                                    192 ;	-------------------------------------- -
      000047 21r00r00         [10]  193 	ld	hl, #_sm_pcm_ptr
      00004A 5E               [ 7]  194 	ld	e, ( hl )
      00004B 23               [ 6]  195 	inc	hl
      00004C 56               [ 7]  196 	ld	d, ( hl )
      00004D 62               [ 4]  197 	ld	h, d
      00004E 6B               [ 4]  198 	ld	l, e; HL = sm_pcm_ptr
                                    199 ;	-------------------------------------- -
                                    200 ;	Load sm_pcm_len → IX
                                    201 ;	-------------------------------------- -
      00004F 21r02r00         [10]  202 	ld	hl, #_sm_pcm_len
      000052 5E               [ 7]  203 	ld	e, ( hl )
      000053 23               [ 6]  204 	inc	hl
      000054 56               [ 7]  205 	ld	d, ( hl )
      000055 D5               [11]  206 	push	de
      000056 DD E1            [14]  207 	pop	ix; IX = sm_pcm_len
                                    208 ;	-------------------------------------- -
                                    209 ;	One PCMENC fragment
                                    210 ;	-------------------------------------- -
      000058 7E               [ 7]  211 	ld	a, ( hl )
      000059 23               [ 6]  212 	inc	hl
                                    213 ;	== = CHANNEL A == =
      00005A 47               [ 4]  214 	ld	b, a
      00005B D6 10            [ 7]  215 	sub	#0x10
      00005D 30 09            [12]  216 	jr	nc, PsgWaitA
      00005F 7E               [ 7]  217 	ld	a, ( hl )
      000060 23               [ 6]  218 	inc	hl
      000061 47               [ 4]  219 	ld	b, a
      000062 E6 0F            [ 7]  220 	and	#0x0f
      000064 F6 90            [ 7]  221 	or	#0x90
      000066 FD 67                  222 	.dw	#0x67FD
      000068                        223 	  PsgWaitA	:
                                    224 ;	== = CHANNEL B == =
      000068 57               [ 4]  225 	ld	d, a
      000069 D6 10            [ 7]  226 	sub	#0x10
      00006B 30 09            [12]  227 	jr	nc, PsgWaitB
      00006D 7E               [ 7]  228 	ld	a, ( hl )
      00006E 23               [ 6]  229 	inc	hl
      00006F 57               [ 4]  230 	ld	d, a
      000070 E6 0F            [ 7]  231 	and	#0x0f
      000072 F6 B0            [ 7]  232 	or	#0xb0
      000074 FD 6F                  233 	.dw	#0x6FFD
      000076                        234 	  PsgWaitB	:
                                    235 ;	== = CHANNEL C == =
      000076 5F               [ 4]  236 	ld	e, a
      000077 D6 10            [ 7]  237 	sub	#0x10
      000079 30 08            [12]  238 	jr	nc, PsgWaitC
      00007B 7E               [ 7]  239 	ld	a, ( hl )
      00007C 23               [ 6]  240 	inc	hl
      00007D 5F               [ 4]  241 	ld	e, a
      00007E E6 0F            [ 7]  242 	and	#0x0f
      000080 F6 D0            [ 7]  243 	or	#0xd0
      000082 4F               [ 4]  244 	ld	c, a
      000083                        245 	  PsgWaitC	:
      000083 D5               [11]  246 	push	de
      000084 FD 54                  247 	.dw	#0x54FD
      000086 FD 55                  248 	.dw	#0x55FD
      000088 79               [ 4]  249 	ld	a, c
      000089 C5               [11]  250 	push	bc
      00008A 0E 7F            [ 7]  251 	ld	c, #0x7f
      00008C ED 51            [12]  252 	out(	c ), d
      00008E ED 59            [12]  253 	out(	c ), e
      000090 ED 79            [12]  254 	out(	c ), a
      000092 C1               [10]  255 	pop	bc
      000093 D1               [10]  256 	pop	de
                                    257 ;	-------------------------------------- -
                                    258 ;	Decrement IX = length
                                    259 ;	-------------------------------------- -
      000094 DD 2B            [10]  260 	dec	ix
      000096 DD E5            [15]  261 	push	ix
      000098 D1               [10]  262 	pop	de
      000099 21r02r00         [10]  263 	ld	hl, #_sm_pcm_len
      00009C 73               [ 7]  264 	ld(	hl ), e
      00009D 23               [ 6]  265 	inc	hl
      00009E 72               [ 7]  266 	ld(	hl ), d
                                    267 ;	-------------------------------------- -
                                    268 ;	Store updated pointer
                                    269 ;	-------------------------------------- -
      00009F 21r00r00         [10]  270 	ld	hl, #_sm_pcm_ptr
      0000A2 75               [ 7]  271 	ld(	hl ), l
      0000A3 23               [ 6]  272 	inc	hl
      0000A4 74               [ 7]  273 	ld(	hl ), h
                                    274 ;	-------------------------------------- -
                                    275 ;	Stop if length == 0
                                    276 ;	-------------------------------------- -
      0000A5 7A               [ 4]  277 	ld	a, d
      0000A6 B3               [ 4]  278 	or	e
      0000A7 20 04            [12]  279 	jr	nz, UpdateDone
      0000A9 AF               [ 4]  280 	xor	a
      0000AA 32r04r00         [13]  281 	ld(	#_sm_pcm_playing ), a
      0000AD                        282 	  UpdateDone	:
      0000AD C9               [10]  283 	ret
                           0000AE   284 	C$sample_manager.c$180$1_0$15	= .
                                    285 	.globl	C$sample_manager.c$180$1_0$15
                                    286 ;sample_manager.c:180: }
                                    287 	.area _CODE
                                    288 	.area _INITIALIZER
                           000000   289 Fsample_manager$__xinit_sm_pcm_ptr$0_0$0 == .
      000000                        290 __xinit__sm_pcm_ptr:
      000000 00 00                  291 	.dw #0x0000
                           000002   292 Fsample_manager$__xinit_sm_pcm_len$0_0$0 == .
      000002                        293 __xinit__sm_pcm_len:
      000002 00 00                  294 	.dw #0x0000
                           000004   295 Fsample_manager$__xinit_sm_pcm_playing$0_0$0 == .
      000004                        296 __xinit__sm_pcm_playing:
      000004 00                     297 	.db #0x00	; 0
                                    298 	.area _CABS (ABS)
